Refactor product search for security (enhanced)
